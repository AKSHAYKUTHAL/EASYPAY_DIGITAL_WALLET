{% extends "partials/dashboard_base.html" %}
{% load static %}
{% load humanize %}
<style>
    
</style>
{% block content %}
    <!-- Dashboard Section start -->
    <section class="dashboard-section body-collapse">
        <div class="overlay pt-120">
            <div class="container-fruid">
                <div class="row">
                    <div class="banner-content">
                        <div class="container wow fadeInUp">
                            <div class="content-shape">
                            </div>
                            <div class="row justify-content-between align-items-center">
                                <div class="col-lg-5 col-md-6">
                                    <div class="main-content">
                                        <div class="top-area section-text">
                                            <h5 class="sub-title" style="color: white;">Trusted by over 3M customers</h5>
                                            <h1 class="title">Pay Anyone, Anywhere</h1>
                                            <p class="xlr">Quickly and easily send, receive and request money online with Easypay. Get a customised solution to fit your business needs.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xxl-4 col-xl-5 col-md-6" style="box-shadow: 0 0 10px rgba(27, 24, 228, 0.657); border-radius: 15px; padding: 20px; background-color: white;" >
                                    <div class="">
                                        <form action="#" method="post">
                                            {% csrf_token %}
                                            <div class="" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background-color: #edefff; padding: 25px; border-radius: 15px;">
                                                <div class="" style="flex-basis: 60%;">
                                                    <span class="mdr" style="color: #4743c9; font-size: 20px;"><b>You send</b></span>
                                                    <input type="number" id="original-currency-amount" placeholder="1000" name="original-currency-amount" style="border: 1px solid #4743c9; border-radius: 10px; padding: 8px; margin-top: 5px; width: 220px;">
                                                </div>
                                                <div class="" style="flex-basis: 40%; border-radius: 20px ; margin-top: 30px; margin-left: 25px;">
                                                    <select id="from_currency"  style="border: 1px solid #4743c9; padding: 10px; color: #4743c9;">
                                                        <option value="INR" style="color: #4743c9;" selected>INR</option>
                                                        <option value="USD" style="color: #4743c9;">USD</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <div class="calculation" style="margin-top: 20px;">
                                                <div class="head-area" style="display: flex; align-items: center; margin-bottom: 20px;">
                                                    <button id="exchange" style="background-color: white;">
                                                        <img src="{% static 'assets/images/icon/icons8-convert-480.png' %}" alt="image" style="width: 30px; height:30px; margin-right: 10px;">
                                                    </button>
                                                    <span class="mdr highlight" style="color: #4743c9;">Invert Currency</span>
                                                </div>
                                                <div class="calculation-details">
                                                    <div class="single-area" style="margin-bottom: 10px; display: flex; align-items: center;">
                                                        <div class="left-area" style="flex-basis: 50%;">
                                                            <i class="fas fa-minus" style="color: #4743c9;"></i>
                                                            <span id="exchange-rate"  class="mdr" style="color: #4743c9;"></span>
                                                        </div>  
                                                        <div class="right-area" style="flex-basis: 50%;">
                                                            <span  class="mdr" style="color: #4743c9;">Rate Today</span>
                                                        </div>
                                                    </div>
                                                    <div class="single-area" style="margin-bottom: 10px; display: flex; align-items: center;">
                                                        <div class="left-area" style="flex-basis: 50%;">
                                                            <i class="fas fa-minus" style="color: #4743c9;"></i>
                                                            <span id="conversion_fee" class="mdr" style="color: #4743c9;"></span>
                                                        </div>  
                                                        <div class="right-area" style="flex-basis: 50%;">
                                                            <span class="mdr" style="color: #4743c9;">Our fee</span>
                                                        </div>
                                                    </div>
                                                    <div class="single-area" style="margin-bottom: 10px; display: flex; align-items: center;">
                                                        <div class="left-area" style="flex-basis: 50%;">
                                                            <i class="fas fa-equals" style="color: #4743c9;"></i>
                                                            <span id="money_after_fee" class="mdr" style="color: #4743c9;"></span>
                                                        </div>
                                                        <div class="right-area" style="flex-basis: 50%;">
                                                            <span class="mdr" style="color: #4743c9;">Weâ€™ll Convert</span>
                                                        </div>
                                                    </div>
                                                    <div class="single-area" style="margin-bottom: 10px; display: flex; align-items: center;">
                                                        <div class="left-area" style="flex-basis: 50%;">
                                                            <i class="fas fa-times" style="color: #4743c9;"></i>
                                                            <span id="easypay_rate" class="mdr" style="color: #4743c9;"></span>
                                                        </div>
                                                        <div class="right-area" style="flex-basis: 50%;">
                                                            <span class="mdr highlight" style="color: #4743c9;">Easypay Rate</span>
                                                        </div>
                                                    </div>
                                                    <button class="btn" id="exchange_button" style="margin-left: 120px; margin-top: 15px;margin-bottom: 15px;color: white; background-color:#4743c9 ;border-radius: 15px;">
                                                        <i class="fas fa-exchange-alt"> Convert</i>
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background-color: #edefff; padding: 25px; border-radius: 15px;">
                                                <div class="" style="flex-basis: 60%;">
                                                    <span class="mdr" style="color: #4743c9; font-size: 20px;"><b>Recipient Gets</b></span>
                                                    <p id="recipient_gets" name="to" style="border: 1px solid #4743c9; border-radius: 10px; padding: 8px; margin-top: 5px; width: 220px; height: 47px; background-color: white;"> </p>
                                                </div>
                                                <div class="" style="flex-basis: 40%; border-radius: 20px ; margin-top: 30px; margin-left: 25px;">
                                                    <select id="to_currency"  style="border: 1px solid #4743c9; padding: 10px; color: #4743c9;">
                                                        <option value="INR" style="color: #4743c9;">INR</option>
                                                        <option value="USD" style="color: #4743c9;" selected>USD</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="btn-area mt-40">
                                                <button type="submit" class="cmn-btn w-100" style="display: inline-block; padding: 12px 30px; background-color: #4743c9; color: #fff; border: none; border-radius: 15px; text-transform: uppercase; text-decoration: none; transition: background-color 0.3s; text-align: center;">Get Started</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <script>
        var input_amount = document.getElementById("original-currency-amount");
        var from_currency = document.getElementById("from_currency");
        var to_currency = document.getElementById("to_currency");
        var exchange_rate = document.getElementById("exchange-rate");
        var conversion_fee = document.getElementById("conversion_fee");
        var money_after_fee = document.getElementById("money_after_fee");
        var easypay_rate = document.getElementById("easypay_rate");
        var recipient_gets_amount = document.getElementById("recipient_gets");

        var exchange = document.getElementById("exchange");
        exchange.addEventListener("click", (e) => {
            e.preventDefault();
            var temp = from_currency.value;
            from_currency.value = to_currency.value;
            to_currency.value = temp;
            calculate();
        });

        function calculate() {
            const from_currency_value = from_currency.value;
            const to_currency_value = to_currency.value;
            let minimum_amount = 100;

            if (from_currency_value === 'INR') {
                minimum_amount = 5000;
            }

            if (input_amount.value < minimum_amount) {
                alert(`Minimum amount should be ${minimum_amount}`);
                return;
            }

            const fee = (input_amount.value * 0.03).toFixed(4);
            const total_amount = parseFloat(input_amount.value);
            

            fetch(`https://api.exchangerate-api.com/v4/latest/${to_currency_value}`)
                .then(res => res.json())
                .then(res => {
                    const exchange_rate_value = res.rates[from_currency_value];
                    alert(exchange_rate_value)
                    
                    const to_amount = (input_amount.value * exchange_rate_value).toFixed(4);
                    const converted_fee = (fee * exchange_rate_value).toFixed(4);
                    const converted_total_amount = (total_amount - fee).toFixed(4);
                    const recipient_gets =parseFloat(converted_total_amount/exchange_rate_value)
                    const rate = parseFloat(total_amount/recipient_gets);

                    exchange_rate.innerText = `${exchange_rate_value} ${to_currency_value}`;
                    conversion_fee.innerText = `${fee} ${from_currency_value}`;
                    money_after_fee.innerText = `${converted_total_amount} ${from_currency_value}`;
                    easypay_rate.innerText = rate.toFixed(4);
                    recipient_gets_amount.innerText = `${recipient_gets.toFixed(4)} ${to_currency_value}`;
                })
                .catch(err => console.log('Error fetching data:', err));
        }


        document.getElementById("exchange_button").addEventListener("click", (e) => {
            e.preventDefault();
            calculate();
        });
    </script>
    
    
    {% endblock content %}
